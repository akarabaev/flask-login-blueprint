{% extends 'base.html' %}


{% block content %}


<div class="bg-white p-4 p-lg-5" id="password-reset">
    <h2 class="mb-4 text-dark">Сброс пароля</h2>
    <!-- <p class="mb-4">Use this awesome form to sign in users.</p> -->
    <form @submit.prevent="onSubmit">
        <div class="mb-3">
            <div class="input-group">
                <span class="bg-light input-group-text" id="addon-wrapping1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="1em" height="1em">
                        <g>
                            <path fill="none" d="M0 0h24v24H0z"></path>
                            <path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm17 4.238l-7.928 7.1L4 7.216V19h16V7.238zM4.511 5l7.55 6.662L19.502 5H4.511z"></path>
                        </g>
                    </svg>
                </span>
                <input 
                    v-model="email" type="text" class="form-control" placeholder="Введите email" 
                    aria-label="User Email" aria-describedby="addon-wrapping1"
                >
            </div>
            <div v-if="emailValidationErrorMessage !== null" class="text-danger">[[ emailValidationErrorMessage ]]</div>
        </div>
        <div v-if="outputMessage != null" class="text-success mb-3 input-group">[[ outputMessage ]]</div>
        <div v-if="formErrorMessage != null" class="text-danger mb-3 input-group">[[ formErrorMessage ]]</div>
        <button type="submit" class="btn d-block w-100 btn-primary fw-bold pb-2 ps-3 pe-3 pt-2">Сбросить</button>
    </form>
</div>


<script>
    new Vue({ 
      el: '#password-reset',
      delimiters: ['[[', ']]'],
      data() {
        return {
            email: null,
            emailValidationErrorMessage: null,
            formErrorMessage: null,
            outputMessage: null
        }
      }, 
      methods: {
        async onSubmit() {
            let formWasFilledIncorrectly = false;

            if (this.email == null){
                this.emailValidationErrorMessage = 'Пожалуйста введите email'
                formWasFilledIncorrectly = true
            }
            else if (!this.email.includes('@')){
                this.emailValidationErrorMessage = 'Некорректный email'
                formWasFilledIncorrectly = true
            }
            else {
                this.emailValidationErrorMessage = null
            }

            if (formWasFilledIncorrectly){
                return;
            }

            const response = await axios.post(
                '/reset_password_request', 
                { 
                    email: this.email
                }
            )

            if (response.data['formErrorMessage']){
                this.formErrorMessage = response.data['formErrorMessage']
                return;
            }
            if (response.data['outputMessage']) {
                this.outputMessage = response.data['outputMessage']
            }
            
        },

      }
  })
</script>



{% endblock %}
